@model List<BOTS_BL.Models.DashboardCustomerLogin>
@using BOTS_BL.Models;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
}

<div class="app-main__inner">
    <div class="row mb-3 card">
        <div class="container-fluid pt-3 pl-3 pr-3">
            <div class="pb-3">
                @*<h4><b>Billing Partner Product Master</b></h4>*@
            </div>

            <div class="pt-3 pl-3 pr-3 col-md-12 col-lg-12">
                <div class="col-md-8 col-lg-8 mb-5" id="divadd" style="display:none; border:1px solid grey; border-radius:10px;">
                    <div class="mb-4">
                        <h6><b>Add Customer Login</b></h6>
                    </div>
                    <div class="col-md-12 col-lg-12 mt-2 mb-4">

                        <div class="row" style="margin: 0;">
                            <div style="float:left;text-align:left;width:100px;margin-top:10px;">
                                Login Type
                            </div>
                            <div>
                                @Html.DropDownList("CustomerLoginType", new SelectList(ViewBag.lstLogintype, "Value", "Text"), htmlAttributes: new { @class = "input100", @id = "ddlCustomerlogintype" })
                            </div>
                        </div>
                        <div class="row mt-2" style="margin: 0;">
                            <div style="float:left;text-align:left;width:100px;margin-top:10px;">
                                Outlet Name
                            </div>
                            <div>
                                @Html.DropDownList("outletlist", new SelectList(ViewBag.lstoutletlist, "Value", "Text"), htmlAttributes: new { @class = "input100", @type = "number", @id = "ddloutletlist", disabled = "true" })
                            </div>
                        </div>
                        <div class="row mt-2" style="margin: 0;">
                            <div style="float:left;text-align:left;width:100px;margin-top:10px;">
                                Mobile Number
                            </div>
                            <div>
                                <input class="input100" type="text" id="txtcustomerloginNm" />
                            </div>
                        </div>
                        <div class="row mt-2" style="margin: 0;">
                            <button class="btn btn-primary login-btn ml-5 mr-2" type="button" id="btnSave">
                                Save
                            </button>
                            <button class="btn btn-primary login-btn" type="button" id="btnCancle">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div style="text-align:right;" class="col search-container">
                        <i class="fas fa-search"></i>
                        <input class="input100" type="text" id="txtSearch" placeholder="Search activity..." />
                    </div>
                    <div style="text-align:right;" class="pr-2">
                        <button class="btn btn-primary login-btn" type="button" id="btnAdd">
                            ADD
                        </button>

                    </div>
                </div>
                <div id="dvcustomer">
                    @Html.Partial("~/Views/DashBoardCustomerLogin/_DashboardCustomerloginList.cshtml", Model)
                </div>
                @*<div class="row mt-3" id="dvActivityData">
                    <div class="table-responsive">
                        <table class="table" id="activityTable">
                            <thead>
                                <tr>
                                    <th scope="col" style="text-align:left;">Mobile Number</th>
                                    <th scope="col" style="text-align:left;">Customer Number</th>
                                    <th scope="col" style="text-align:left;">Created On</th>
                                    <th scope="col" style="text-align:left;">Outlet Name</th>

                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>*@
            </div>
        </div>
    </div>
</div>
<script>

    $(document).ready(function () {
        BindcustomerList();
    });
    var tableData = [];
    $('#btnAdd').on("click", function () {
        $("#divadd").show(1000);

    });
    $('#btnCancle').on("click", function () {
        $("#divadd").hide(1000);
        $('#divadd').find(':input').val('');
        $("#txtcustomerloginNm").text("");
    });
    $("#ddlCustomerlogintype").change(function () {
        var selected = $("#ddlCustomerlogintype option:selected").val();
        console.log(selected);       
        if (selected == "Outlet") {           
            $('#ddloutletlist').prop('disabled', false);        
            
        }        
         if(selected == "Admin") {           
            $('#ddloutletlist').prop('disabled', true);
        }
        
    });
    function BindcustomerList() {
        console.log("hi");
        $.ajax({
                type: "POST",
                url: '@Url.Action("GetDashboardlogins", "DashBoardCustomerLogin")',          
                contentType: "application/json; charset=utf-8",
                dataType: "json",
            success: function (responce) {
                console.log(responce);
                $("#dvcustomer").html(responce);

            },
            error: function (responce) {
                $("#dvcustomer").html(responce.responseText);

            }
            });
    }
    //function DrawTable() {
    //    var table1 = $('#activityTable').DataTable();
    //    table1.destroy();

    //    var table = $('#activityTable').DataTable({
    //        "data": tableData,
    //        "paging": true,
    //        "ordering": false,
    //        "info": true,
    //        "bFilter": true,
    //        "pageLength": 10,
    //        "pagingType": "simple_numbers",
    //        "columns": [
    //            { data: "MobileNo" },
    //            { data: "CustomerName" },
    //            { data: "CreatedOn" },
    //            {
    //                data:"OutletName"
    //            },
                

    //        ],
    //        aoColumnDefs: [
    //            {
    //                bSortable: false,
    //                aTargets: []
    //            }
    //        ]
    //    });
    //    $('#activityTable_filter').hide();
    //    $('#txtSearch').on('keyup', function () {

    //        $.fn.dataTable.ext.search.push(function (settings, searchData) {
    //            var term = $('#txtSearch').val().toLowerCase()
    //            for (var i = 0; i < searchData.length; i++) {
    //                if (searchData[i].toLowerCase().indexOf(term) == 0) {
    //                    return true;
    //                }
    //            }
    //            return false;
    //        });
    //        var table = $('#activityTable').DataTable();
    //        table.draw();
    //    });

    //}
    
     $('#btnSave').on("click", function () {

         if ($('#txtcustomerloginNm').val() == "") {
            toastr.error('Please enter Customer Mobile number');
             $('#txtcustomerloginNm').focus();
            return false;
         }
         var selected = $("#ddlCustomerlogintype option:selected").val();
         if (selected == "0") {
             toastr.error('Please select Customer login type');
             return false;
         }
         var selectedoutlet = $("#ddloutletlist option:selected").val();
         if (confirm("Are you sure? You want to Create Customer login")) {
            var Customerlogindata = [];
            item = {}
             item["Customermobileno"] = $("#txtcustomerloginNm").val();
             
            
             if (selected =="Outlet") {
                 item["outletid"] = selectedoutlet;                
                 item["Logintype"] = "04";
            }
            else {
                 item["outletid"] = null;
                 item["Logintype"] = "02";
             }
             
             Customerlogindata.push(item);
             var data = JSON.stringify(Customerlogindata);
            console.log(data)
            $("#divLoader").show();
            $.ajax({
                type: "POST",
                url: '@Url.Action("AddCustomerLogin", "DashBoardCustomerLogin")',
                data: '{jsonData: ' + JSON.stringify(data) + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result.ResponseCode == "00") {
                        toastr.success(result.ResponseMessage);
                        console.log("hi");
                        $("#txtcustomerloginNm").val("");                        
                        BindcustomerList();
                        $("#divLoader").hide();
                    }
                    else {
                        toastr.error(result.ResponseMessage);
                        $("#divLoader").hide();
                    }
                },
                error: function (result) {
                    console.log(result.responseText)
                    if (result.responseText == "True") {
                        toastr.success("Data Updated Successfully");
                        $("#divLoader").hide();
                    }
                    else {
                        toastr.error('error occured while saving data');
                        $("#divLoader").hide();
                    }
                }
            });
       // }
    }
     });

</script>
<style>
    table.dataTable thead .sorting_asc {
        background: url("https://cdn.datatables.net/1.10.0/images/sort_asc.png") no-repeat center left;
    }

    table.dataTable thead .sorting_desc {
        background: url("https://cdn.datatables.net/1.10.0/images/sort_desc.png") no-repeat center left;
    }

    table.dataTable thead .sorting {
        background: url("https://cdn.datatables.net/1.10.0/images/sort_both.png") no-repeat center left;
    }
</style>


