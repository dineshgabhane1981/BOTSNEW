@model BOTS_BL.Models.TelecallerCustomerData
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="app-main__inner">
    <div class="row mb-3 card">
        <div class="container-fluid pt-3 pl-3 pr-3" style="text-align:center;">

            <input type="number" id="txtmobileNo" class="input50" placeholder="Enter Mobile No" />
            <button class="btn btn-primary login-btn ml-2 mr-2" type="button" id="btnSave" onclick="Submit();">
                Submit
            </button>
            <br /><br />
        </div>
    </div>
    <div class="row mb-3 card">
        <div class="container-fluid pt-3 pl-3 pr-3" id="divdata" style="display:none;padding-left:300px !important;">
            <div class="row mb-3">
                <div class="col-md-4 col-xl-4">
                    <b>Mobile No: </b><span id="spMobileNo"></span>
                </div>
                <div class="col-md-4 col-xl-4">
                    <b>Customer Name: </b> <input type="text" id="spCustName" class="input100" />
                    @*<span id="spCustName"></span>*@
                </div>

            </div>
            <div class="row mb-3">
                <div class="col-md-4 col-xl-4">
                    <b>Enrollment Date: </b><span id="spenrolldt"></span>
                </div>
                <div class="col-md-4 col-xl-4">
                    @*Gender:<span id="spGender"></span>*@
                    <b> Gender </b><br /> @Html.DropDownList("Gender", new SelectList(ViewBag.lstGenderList, "Value", "Text"), htmlAttributes: new { @class = "input50", @id = "ddlgender" })

                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-4 col-xl-4">
                    <b>Total Balance Points: </b> <span id="sptotalpoints"></span>
                </div>
                <div class="col-md-4 col-xl-4">
                    <b>Date Of Anniversary: </b><br /><input type="date" id="txtDOA" class="input50" />
                </div>
               
            </div>
            <div class="row mb-3">
                <div class="col-md-4 col-xl-4">
                    <b>
                        Outlet Name:
                    </b>
                    <span id="spoutletNm"></span>
                    <span style="display:none;" id="spoutletId"></span>
                </div>
                <div class="col-md-4 col-xl-4">
                    <b>Date Of Birth: </b> <br /><input type="date" id="txtDOB" class="input50" />
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-4 col-xl-4">
                    <b>Last Txn Date: </b><span id="spLasttxndt"></span>
                </div>
                <div class="col-md-4 col-xl-4">

                    <b> Comments: </b> <textarea class="input100" id="txtcomment" cols="80" rows="5" placeholder="Enter Comments"></textarea>

                </div>
            </div>
            <div class="row">

                <div class="col-md-6 col-xl-6" style="text-align:center;margin-bottom:20px;">
                    <button class="btn btn-primary login-btn ml-2 mr-2" type="button" id="btnSave" onclick="SaveData();">
                        Save
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#txtmobileNo").focusout(function () {
            if ($("#txtmobileNo").val() != "") {
                $('#txtmobileNo').css('border-color', '');
            }
            else {
                $('#txtmobileNo').css('border-color', 'red');
            }
        });

    });
    function Submit() {
        var returnStatus = true;
        var MobileNo = $("#txtmobileNo").val();
        if ($("#txtmobileNo").val() == "") {
            cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Please Enter Mobile No",
                buttonText: "Okay"
            })
            $('#txtmobileNo').css('border-color', 'red');
            returnStatus = false;
        }
        else {
            if (/^[6789]\d{9,9}$/.test(MobileNo)) {

            }
            else {
                cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Please Enter Correct Mobile No",
                buttonText: "Okay"
            })
                $('#txtmobileNo').css('border-color', 'red');
                returnStatus = false;
            }
        }
        if (returnStatus == true) {
            $("#divLoader").show();
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetCustomerData", "Telecaller")',
                data: '{MobileNo: ' + JSON.stringify($('#txtmobileNo').val()) + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {

                    if (response != null) {
                        console.log(response);
                        $("#spCustName").val(response.CustomerName);
                        $("#ddlgender").val(response.Gender);
                        $("#txtDOB").val(response.DOB);
                        $("#txtDOA").val(response.DOA);
                        $("#spMobileNo").text(response.MobileNo);
                        $("#spenrolldt").text(response.EnrollmentDate);
                        $("#sptotalpoints").text(response.TotalBalPoints);
                        $("#spLasttxndt").text(response.LastTxnDate);
                        $("#spoutletNm").text(response.OutletName);
                        $("#spoutletId").text(response.outletid);


                        $("#divdata").show();
                    }
                    $("#divLoader").hide();

                },
                error: function (result) {
                    cuteAlert({
                        type: "error",
                        title: "Oops..",
                        message: "Mobile No does not exist, please check again",
                        buttonText: "Okay"
                    })
                    console.log(result.responseText);
                    $("#divLoader").hide();
                }
            });
        }
    }
    function SaveData() {
       
        $("#divLoader").show();
        var FilterData = [];
        item = {};
        item["MobileNo"] = $("#txtmobileNo").val();
        item["CustNm"] = $("#spCustName").val();
        item["Gender"] = $('#ddlgender :selected').val();
        item["DOB"] = $("#txtDOB").val();
        item["DOA"] = $("#txtDOA").val();
        item["Points"] = 0;
        item["outletId"] = $("#spoutletId").text();
        item["Comments"] = $("#txtcomment").val();
        FilterData.push(item);
        var data = JSON.stringify(FilterData);
            $.ajax({
                type: "POST",
                url: '@Url.Action("SaveTelecallerData", "Telecaller")',
                data: '{jsonData: ' + JSON.stringify(data) + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {                    
                    if (response) {
                        $("#divLoader").hide();
                        $("#divdata").hide();
                        $("#txtmobileNo").val("");

                        cuteAlert({
                            type: "success",
                            title: "Save",
                            message: "Data Save Successfully!",
                            buttonText: "Okay"
                        }).then(() => {
                        window.location.reload();
                    });                         
                    }
                    $("#divLoader").hide();
                },
                error: function (result) {
                    
                    console.log(result.responseText);
                    $("#divLoader").hide();
                }
            });
        
    }
</script>

<style>

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>