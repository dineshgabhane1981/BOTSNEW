@model WebApp.ViewModel.SinglePageViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    body {
        background: #CDDC39;
        font-family: 'Arimo', sans-serif;
    }

    h2 {
        color: #000;
        text-align: center;
        font-size: 2em;
    }

    .warpper {
        display: grid;
        flex-direction: column;
        align-items: center;
    }

    .tab {
        cursor: pointer;
        padding: 10px 20px;
        margin: 0px 2px;
        background-color: #2f4353 !important;
        display: inline-block;
        color: #fff;
        border-radius: 3px 3px 0px 0px;
        box-shadow: 0 0.5rem 0.8rem #00000080;
    }

    .tabs {
        padding-left: 25px;
    }

    .panels {
        background: #ffffff;
        box-shadow: 0 2rem 2rem #00000080;
        width: 100%;
        border-radius: 3px;
        overflow: hidden;
    }

    .panel {
        display: none;
        animation: fadein .8s;
    }

    .panel-title {
        font-size: 1.5em;
        font-weight: bold
    }

    .radio {
        display: none;
    }

    #one:checked ~ .panels #one-panel,
    #two:checked ~ .panels #two-panel,
    #three:checked ~ .panels #three-panel,
    #four:checked ~ .panels #four-panel,
    #five:checked ~ .panels #five-panel {
        display: block
    }

    #one:checked ~ .tabs #one-tab,
    #two:checked ~ .tabs #two-tab,
    #three:checked ~ .tabs #three-tab,
    #four:checked ~ .tabs #four-tab,
    #five:checked ~ .tabs #five-tab {
        background: #fff !important;
        color: #000;
        border-top: 3px solid #fff;
        border-left: 3px solid #fff;
        border-right: 3px solid #fff;
        font-weight: bold;
        border-top-left-radius: 7px;
        border-top-right-radius: 7px;
    }
</style>
<div class="app-main__inner">
    <div class="row mb-3 pt-3 pl-3 pr-3 card">
        @*<div class="warpper">*@
        <input class="radio" id="one" name="group" type="radio" checked>
        <input class="radio" id="two" name="group" type="radio">
        <input class="radio" id="three" name="group" type="radio">
        <input class="radio" id="four" name="group" type="radio">
        <input class="radio" id="five" name="group" type="radio">
        <div class="tabs">
            <label class="tab" id="one-tab" for="one">Non-Transacting Group</label>
            <label class="tab" id="two-tab" for="two">Communication</label>
            <label class="tab" id="three-tab" for="three">Key Indicator</label>
            <label class="tab" id="four-tab" for="four">CityWiseGroup</label>

        </div>
        <div class="panels">
            <div class="multisteps-form__panel shadow p-4 m-4 list-box bg-white panel" id="one-panel">
                <div class="row mb-5 ml-2">
                    <div class=" mr-2">
                        <table border="1">
                            <thead><h6><b>Summary</b></h6></thead>
                            <tbody>
                                <tr>
                                    <td class="font-weight-bold">Total Enrolled Base</td>
                                    <td>@Model.lstsummarytable.TotalEnrolledBase</td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold">Txn Count(Daily)</td>
                                    <td>@Model.lstsummarytable.TxnCountDaily</td>
                                </tr>
                                <tr>
                                    <td class="font-weight-bold">Txn Count(MTD)</td>
                                    <td>@Model.lstsummarytable.TxnCountMTD</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                    <div class="mb-5 ml-3">
                        <table border="1">
                            <thead><h6><b>Non Transacting Group</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Days Since Last Txn</th>
                            </tr>
                            <tbody>
                                @{int indexnew = 1;}
                                @if (Model.lstnontransactingGrp != null)
                                {
                                    if (Model.lstnontransactingGrp.Count > 0)
                                    {
                                        foreach (var item in Model.lstnontransactingGrp)
                                        {
                                            if (indexnew <= 5)
                                            {
                                                <tr>
                                                    <td>@indexnew</td>

                                                    <td style="text-align:left;">@item.GroupName</td>
                                                    <td style="text-align:left;">@item.DaysSinceLastTxn</td>
                                                </tr>
                                            }
                                            indexnew++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>

                    </div>
                    <div class="mb-5 ml-3">
                        <table border="1">
                            <thead><h6><b>Non Transacting Group</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Last Txn Date</th>
                                <th scope="col" style="text-align:left;">Days Since Last Txn</th>
                            </tr>
                            <tbody>
                                @{int index = 1;}
                                @if (Model.lstnontransactingGrp != null)
                                {
                                    if (Model.lstnontransactingGrp.Count > 0)
                                    {
                                        foreach (var item in Model.lstnontransactingGrp)
                                        {

                                            <tr>
                                                <td>@index</td>
                                                <td style="text-align:left;">@item.GroupName</td>
                                                <td style="text-align:left;">@item.LastTxnDate</td>
                                                <td style="text-align:left;">@item.DaysSinceLastTxn</td>
                                            </tr>
                                            index++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="row mb-5 ml-2">

                    <div class="mb-5">
                        <table border="1">
                            <thead><h6><b>Non Transacting Outlet</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Outlet Name</th>
                                <th scope="col" style="text-align:right;">Avg Group Txns</th>
                                <th scope="col" style="text-align:left;">Last Txn Date</th>
                                <th scope="col" style="text-align:left;">Days Since Last Txn</th>

                            </tr>
                            <tbody>
                                @{int index1 = 1;}
                                @if (Model.lstnontransactingOutlet != null)
                                {
                                    if (Model.lstnontransactingOutlet.Count > 0)
                                    {
                                        foreach (var item in Model.lstnontransactingOutlet)
                                        {

                                            <tr>
                                                <td>@index1</td>
                                                <td style="text-align:left;">@item.GroupName</td>
                                                <td style="text-align:left;">@item.OutletName</td>
                                                <td style="text-align:left;">@item.AvgGroupTxn</td>
                                                <td style="text-align:left;">@item.LastTxnDate</td>
                                                <td style="text-align:left;">@item.DaysSinceLastTxn</td>
                                            </tr>
                                            index1++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="mb-5">
                        <table border="1">
                            <thead><h6><b>Low Transacting Outlet</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Outlet Name</th>
                                <th scope="col" style="text-align:right;">Avg Txns</th>
                                <th scope="col" style="text-align:left;">Avg Group Txns/Avg 30 days</th>
                                <th scope="col" style="text-align:left;">Lower by %</th>

                            </tr>
                            <tbody>
                                @{int index2 = 1;}
                                @if (Model.lstlowtransactingOutlet != null)
                                {
                                    if (Model.lstlowtransactingOutlet.Count > 0)
                                    {
                                        foreach (var item in Model.lstlowtransactingOutlet)
                                        {

                                            <tr>
                                                <td>@index2</td>
                                                <td style="text-align:left;">@item.GroupName</td>
                                                <td style="text-align:left;">@item.OutletName</td>
                                                <td style="text-align:left;">@item.AvgTxn</td>
                                                <td style="text-align:left;">@item.AvgGroupTxnIn30Days</td>
                                                <td style="text-align:left;">@item.LowerByPercentage</td>
                                            </tr>
                                            index2++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="two-panel" class="multisteps-form__panel shadow p-4 m-4 list-box bg-white panel">
                <div class="row mb-5 ml-2">
                    <div class="mr-3">
                        <table border="1">
                            <thead><h6><b>Whats App Expiry Date</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Outlet Name</th>
                                @*<th scope="col" style="text-align:left;">Low SMS Balance</th>
                                    <th scope="col" style="text-align:left;">Low Virtual SMS Balance</th>
                                    <th scope="col" style="text-align:left;">Low Whats App Balance</th>*@
                                <th scope="col" style="text-align:left;">Whats App Expiry</th>
                            </tr>
                            <tbody>
                                @{int indexcomm = 1;}
                                @if (Model.lstCommunication.objWhatsAppExpiryDate != null)
                                {
                                    if (Model.lstCommunication.objWhatsAppExpiryDate.Count > 0)
                                    {
                                        foreach (var item in Model.lstCommunication.objWhatsAppExpiryDate)
                                        {

                                            <tr>
                                                <td>@indexcomm</td>

                                                <td style="text-align:left;">@item.BrandName</td>
                                                <td style="text-align:left;">@item.OutletName</td>
                                                <td style="text-align:left;">@item.WAExpiryDate</td>
                                            </tr>

                                            indexcomm++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="mr-1">
                        <table border="1">
                            <thead><h6><b>Low Whats App Balance</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Outlet Name</th>
                                <th scope="col" style="text-align:left;">WhatsApp Balance</th>
                            </tr>
                            <tbody>
                                @{int indexcomm1 = 1;}
                                @if (Model.lstCommunication.objWhatsAppBalance != null)
                                {
                                    if (Model.lstCommunication.objWhatsAppBalance.Count > 0)
                                    {
                                        foreach (var item in Model.lstCommunication.objWhatsAppBalance)
                                        {

                                            <tr>
                                                <td>@indexcomm1</td>

                                                <td style="text-align:left;">@item.BrandName</td>
                                                <td style="text-align:left;">@item.OutletName</td>
                                                <td style="text-align:left;">@item.WABalance</td>
                                            </tr>

                                            indexcomm1++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row mb-5 ml-2">
                    <div class="mr-2">
                        <table border="1">
                            <thead><h6><b>Low SMS Balance</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Outlet Name</th>
                                <th scope="col" style="text-align:left;">SMS Balance</th>
                            </tr>
                            <tbody>
                                @{int indexcomm2 = 1;}
                                @if (Model.lstCommunication.objSMSBalance != null)
                                {
                                    if (Model.lstCommunication.objSMSBalance.Count > 0)
                                    {
                                        foreach (var item in Model.lstCommunication.objSMSBalance)
                                        {

                                            <tr>
                                                <td>@indexcomm2</td>

                                                <td style="text-align:left;">@item.BrandName</td>
                                                <td style="text-align:left;">@item.OutletName</td>
                                                <td style="text-align:left;">@item.SmsBalance</td>
                                            </tr>

                                            indexcomm2++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="mr-2">
                        <table border="1">
                            <thead><h6><b>Low Virtual SMS Balance</b></h6></thead>
                            <tr>
                                <th scope="col" style="text-align:left;">Sr No</th>
                                <th scope="col" style="text-align:left;">Group Name</th>
                                <th scope="col" style="text-align:left;">Outlet Name</th>
                                <th scope="col" style="text-align:left;">Virtual SMS Balance</th>
                            </tr>
                            <tbody>
                                @{int indexcomm3 = 1;}
                                @if (Model.lstCommunication.objVirtualSMSBalance != null)
                                {
                                    if (Model.lstCommunication.objVirtualSMSBalance.Count > 0)
                                    {
                                        foreach (var item in Model.lstCommunication.objVirtualSMSBalance)
                                        {

                                            <tr>
                                                <td>@indexcomm3</td>

                                                <td style="text-align:left;">@item.BrandName</td>
                                                <td style="text-align:left;">@item.OutletName</td>
                                                <td style="text-align:left;">@item.VirtualsmsBalance</td>
                                            </tr>

                                            indexcomm3++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="three-panel" class="multisteps-form__panel shadow p-4 m-4 list-box bg-white panel">
                @*<div id="dvmetrics">
                        @Html.Partial("~/Views/SinglePage/_LowerMetrics.cshtml",Model.lstlowermetrics)
                    </div>*@
                <div class="row mb-2">
                    <input type="radio" id="rdnlowerRedemRate" checked name="cust_type" />&nbsp; Lower Redemption Rate &nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="radio" id="rdndHigherOnly" name="cust_type" />&nbsp; Higher Only Once &nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="radio" id="rdnLowProfile" name="cust_type" />&nbsp; Low Profile Updates &nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="radio" id="rdnLowReferrals" name="cust_type" />&nbsp; Low Referrals &nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="radio" id="rdnLowReferralconversion" name="cust_type" />&nbsp; Low Referrals Conversions<br /><br />
                    <button type="button" id="btnFilter" style="margin-left:17px;" class="btn btn-primary"><b>FILTER</b></button>
                </div>
                <div>
                    <table border="1" cellpadding="4" cellspacing="4" style="border:1px solid gray;" width="100%" id="activityTable">
                        <thead>
                            <h6><b></b></h6>
                            <tr>

                                <th scope="col" colspan="2" style="text-align: center;">Less than 6 months</th>
                                <th scope="col" colspan="2" style="text-align: center;">6m to 1 years</th>
                                <th scope="col" colspan="2" style="text-align: center;">1 to 2 years</th>
                                <th scope="col" colspan="2" style="text-align: center;">2 to 3 years</th>
                                <th scope="col" colspan="2" style="text-align:center;">More than 3 years</th>



                            </tr>
                            <tr>

                                <th>Group Name</th>
                                <th>Value</th>
                                <th>Group Name</th>
                                <th>Value</th>
                                <th>Group Name</th>
                                <th>Value</th>
                                <th>Group Name</th>
                                <th>Value</th>
                                <th>Group Name</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                            @*@if (Model != null)
        {
            if (Model.Count > 0)
            {
                foreach (var item in Model)
                {

                    <tr>


                        <td style="text-align:left;">@item.GroupNamelessthan5</td>
                        <td style="text-align:left;">@item.Valuethanlessthan5</td>

                        <td style="text-align:left;">@item.GroupNamelessthan10</td>
                        <td style="text-align:left;">@item.Valuelessthan10</td>

                        <td style="text-align:left;">@item.GroupNamelessthan15</td>
                        <td style="text-align:left;">@item.Valuelessthan15</td>

                        <td style="text-align:left;">@item.GroupNamelessthan30</td>
                        <td style="text-align:left;">@item.Valuelessthan30</td>

                        <td style="text-align:left;">@item.GroupNamelessthan40</td>
                        <td style="text-align:left;">@item.Valuelessthan40</td>
                    </tr>


                }
            }
        }*@
                        </tbody>
                    </table>
                </div>

            </div>
            <div id="four-tab" class="multisteps-form__panel shadow p-4 m-4 list-box bg-white panel">

            </div>
        </div>
    </div>
    @*</div>*@

    <script>
        var tableData = [];
    $(document).ready(function () {
        GetData();
    });
        function GetData() {
            $("#divLoader").show();
            var TableId;
            if ($("#rdnlowerRedemRate").is(":checked")) {

                TableId = "1";
            }
            else if ($("#rdndHigherOnly").is(":checked")) {
                TableId = "2";
            }
            else if ($("#rdnLowProfile").is(":checked")) {
                TableId = "3";
            }
            else if ($("#rdnLowReferrals").is(":checked")) {
                TableId = "4";
            }
            else if ($("#rdnLowReferralconversion").is(":checked")) {
                TableId = "5";
            }

             $.ajax({
             type: "POST",
            url: '@Url.Action("GetLowerMetricsData", "SinglePage")',
                 data: '{Id:' + JSON.stringify(TableId) + '}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
                 success: function (response) {
                     if (response != null) {
                         console.log(response);
                         tableData.length = 0;
                         $.map(response, function (item) {
                             optionItem = {}
                             optionItem["GroupNameLT5"] = item.GroupNamelessthan5;
                             optionItem["ValueLT5"] = item.Valuethanlessthan5;
                             optionItem["GroupNameLT10"] = item.GroupNamelessthan10;
                             optionItem["ValueLT10"] = item.Valuelessthan10;
                             optionItem["GroupNameLT15"] = item.GroupNamelessthan15;
                             optionItem["ValueLT15"] = item.Valuelessthan15;
                             optionItem["GroupNameLT30"] = item.GroupNamelessthan30;
                             optionItem["ValueLT30"] = item.Valuelessthan30;
                             optionItem["GroupNameLT40"] = item.GroupNamelessthan40;
                             optionItem["ValueLT40"] = item.Valuelessthan40;
                             tableData.push(optionItem);
                             console.log(tableData);
                         });
                         DrawTable();

                     }
                     $("#divLoader").hide();
            },
                 failure: function (response) {
                     console.log(response);
                $("#divLoader").hide();
            },
                 error: function (response) {
                     console.log(response);
               // $("#dvmetrics").html(response.responseText);
                $("#divLoader").hide();

            }
        });
        }
        $("#btnFilter").click(function () {
            GetData();
        });
        function DrawTable() {
            var table1 = $('#activityTable').DataTable();
            table1.destroy();
            console.log(tableData)
            var table = $('#activityTable').DataTable({
                "data": tableData,
                "paging": true,
                "ordering": false,
                "info": true,
                "bFilter": true,
                "pageLength": 10,
                "pagingType": "simple_numbers",
                "columns": [
                    { data: "GroupNameLT5" },
                    { data: "ValueLT5" },
                    { data: "GroupNameLT10" },
                    { data: "ValueLT10" },
                    { data: "GroupNameLT15" },
                    { data: "ValueLT15" },
                    { data: "GroupNameLT30" },
                    { data: "ValueLT30" },
                    { data: "GroupNameLT40" },
                    { data: "ValueLT40" }
                ],
                aoColumnDefs: [
                    {
                        bSortable: false,
                        aTargets: []
                    }
                ]
            });
            $('#activityTable_filter').hide();
            $('#txtSearch').on('keyup', function () {

                $.fn.dataTable.ext.search.push(function (settings, searchData) {
                    var term = $('#txtSearch').val().toLowerCase()
                    for (var i = 0; i < searchData.length; i++) {
                        if (searchData[i].toLowerCase().indexOf(term) == 0) {
                            return true;
                        }
                    }
                    return false;
                });
                var table = $('#activityTable').DataTable();
                table.draw();
            });

        }
        //function DrawTable() {
        //    var table1 = $('#activityTable').DataTable();
        //    table1.destroy();

        //    var table = $('#activityTable').DataTable({
        //        "data": tableData,
        //        "paging": true,
        //        "ordering": false,
        //        "info": true,
        //        "bFilter": true,
        //        "pageLength": 10,
        //        "pagingType": "simple_numbers",
        //        "columns": [
        //            { data: "GroupNameLT5" },
        //            { data: "ValueLT5" },
        //            { data: "GroupNameLT10" },
        //            { data: "ValueLT10" },
        //            { data: "GroupNameLT15" },
        //            { data: "ValueLT15" },
        //            { data: "GroupNameLT30" },
        //            { data: "ValueLT30" },
        //            { data: "GroupNameLT40" },
        //            { data: "ValueLT40" }

        //        ],
        //        aoColumnDefs: [
        //            {
        //                bSortable: false,
        //                aTargets: []
        //            }
        //        ]
        //    });
        //    $('#activityTable_filter').hide();
        //    $('#txtSearch').on('keyup', function () {

        //        $.fn.dataTable.ext.search.push(function (settings, searchData) {
        //            var term = $('#txtSearch').val().toLowerCase()
        //            for (var i = 0; i < searchData.length; i++) {
        //                if (searchData[i].toLowerCase().indexOf(term) >= 0) {
        //                    return true;
        //                }
        //            }
        //            return false;
        //        });
        //        var table = $('#activityTable').DataTable();
        //        table.draw();
        //    });

        //}
    </script>
    <script src="~/Scripts/jquery-ui-1.12.1.js"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>


    <style>
        table.dataTable thead .sorting_asc {
            background: url("https://cdn.datatables.net/1.10.0/images/sort_asc.png") no-repeat center left;
        }

        table.dataTable thead .sorting_desc {
            background: url("https://cdn.datatables.net/1.10.0/images/sort_desc.png") no-repeat center left;
        }

        table.dataTable thead .sorting {
            background: url("https://cdn.datatables.net/1.10.0/images/sort_both.png") no-repeat center left;
        }
    </style>
