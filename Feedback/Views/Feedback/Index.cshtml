@*@model List<BOTS_BL.Models.FeedBack.FeedBackQuestionMaster>*@

@{
    ViewBag.Title = "Feedback";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    body {
        font-size: 16px !important;
    }
    .cc-selector input {
        margin: 0;
        padding-right: 5px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
    }

    .rbtvariety1 {
        background-image: url("../Content/assets/images/15.png");
    }

    .rbtvariety2 {
        background-image: url("../Content/assets/images/3.png");
    }
    .rbtvariety3 {
        background-image: url("../Content/assets/images/7.png");
    }

    .rbtvariety4 {
        background-image: url("../Content/assets/images/14.png");
    }
    .cc-selector input:active + .drinkcard-cc {
         opacity: .9;
        
    }

    .cc-selector input:checked + .drinkcard-cc {
        -webkit-filter: none;
        -moz-filter: none;
        filter: none;
        border:2px solid red;
        border-radius:25px;
    }   
   
    .drinkcard-cc {
        cursor: pointer;
        background-size: contain;
        background-repeat: no-repeat;
        display: inline-block;       
        width: 45px;
        height: 45px;
        -webkit-transition: all 100ms ease-in;
        -moz-transition: all 100ms ease-in;
        transition: all 100ms ease-in;
        -webkit-filter: brightness(1.2) grayscale(.5) opacity(.9);
        -moz-filter: brightness(1.2) grayscale(.5) opacity(.9);
        filter: brightness(1.2) grayscale(.5) opacity(.9);
        /* -webkit-filter: brightness(1.8) grayscale(1) opacity(.7);
        -moz-filter: brightness(1.8) grayscale(1) opacity(.7);
        filter: brightness(1.8) grayscale(1) opacity(.7);*/
    }   

    

</style>
<div class="app-main__inner">
    <input type="hidden" id="hdngroupid" value="@ViewBag.GroupId" />
    <input type="hidden" id="hdnoutletid" value="@ViewBag.OutletId" />
    
    <div class="row card">
        <div class="col-md-12 col-sm-12 pt-3 pl-3 pr-3" style="text-align:center;">
            <img src="../Content/assets/images/GoldMartLogo.png" />
        </div>
        <div class="container-fluid pt-3 pl-3 pr-3 pb-3" id="divwelcome">
            <div class="row">
                <div class="col-md-12 col-sm-12 pt-3 pl-3 pr-3" style="text-align:center;">
                    <h1 style="font-size:34px;">Welcome!</h1>
                </div>
                <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5" style="text-align:center;">
                    <h2 style="font-size:26px;">Your feedback is critical!!</h2>
                </div>
                <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5" style="text-align:center;">
                    <h3 style="font-size:20px;">Get rewarded with <b style="color:red;">50 Loyalty Points</b> on completion!!!</h3>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5 pb-5" style="text-align:center;">                    
                    <input type="number" class="input100" id="txtMobileNo" placeholder="Enter Mobile number" />

                </div>
                <div class="col-md-12 col-sm-12 pb-5" style="text-align:center;">
                    <button type="button" class="btn btn-primary" style="width: 280px; background-color: #1C699F; color:white; font-weight:bold; font-size:18px; border-radius:5px;" id="btnProceed" onclick="return CheckCustomer();">ENTER</button>
                </div>
            </div>
        </div>

       
        <div class="container-fluid pt-3 pl-3 pr-3 pb-3" style="display:none;" id="divmember">
            <div class="row">
                <div class="col-md-12 col-sm-12 pt-3 pl-3 pr-3" style="text-align:center;">

                    <h1 style="color: red; font-size: 34px;">Welcome <span id="spnCustName"></span>,</h1>
                </div>
                <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5" style="text-align:center;">
                    <h2 style="font-size:26px;">
                        Please rate us for today’s experience!!!
                    </h2>
                </div>

                <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5" style="text-align:center;">                    
                    <h3 style="font-size:20px;">
                        How did you find our <b>Variety</b>?
                    </h3>
                   
                <div class="cc-selector">
                    <input id="rbtvariety1" type="radio" name="variety"  />
                    <label class="drinkcard-cc rbtvariety1" for="rbtvariety1"></label>
                    <input id="rbtvariety2" type="radio" name="variety"  />
                    <label class="drinkcard-cc rbtvariety2" for="rbtvariety2"></label>
                    <input id="rbtvariety3" type="radio" name="variety" />
                    <label class="drinkcard-cc rbtvariety3" for="rbtvariety3"></label>
                    <input id="rbtvariety4" type="radio" name="variety" />
                    <label class="drinkcard-cc rbtvariety4" for="rbtvariety4"></label>                   
                </div>
                    
                </div>
                <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5 mb-2" style="text-align:center;">
                    <h3 style="font-size:20px;">
                        What do you feel about our <b>Service</b>?
                    </h3>
                    
                    <div class="cc-selector">
                        <input id="rbtservice1" type="radio" name="service"   />
                        <label class="drinkcard-cc rbtvariety1" for="rbtservice1"style="padding-right:2px;"></label>
                        <input id="rbtservice2" type="radio" name="service"  />
                        <label class="drinkcard-cc rbtvariety2" for="rbtservice2"></label>
                        <input id="rbtservice3" type="radio" name="service" />
                        <label class="drinkcard-cc rbtvariety3" for="rbtservice3"></label>
                        <input id="rbtservice4" type="radio" name="service" />
                        <label class="drinkcard-cc rbtvariety4" for="rbtservice4"></label>
                    </div>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-md-12 col-sm-12 pb-5" style="text-align:center;">
                    <button type="button" class="btn btn-primary" style="width: 280px; background-color: #1C699F; color:white; font-weight:bold; font-size:18px; border-radius:5px;" id="btnNextpg" onclick="SubmitRating();">Next Page</button>
                </div>
            </div>
        </div>
        
            <div class="container-fluid pt-3 pl-3 pr-3 pb-3" id="divthankyou" style="display:none;">
                <div class="row">
                    <div class="col-md-12 col-sm-12 pt-3 pl-3 pr-3" style="text-align:center;">
                        <h1 style="color:red; font-size:34px;">
                            <b> Thank you <span id="spnCustName1"></span> for your valuable feedback!</b>
                        </h1>
                    </div>
                    <div class="col-md-12 col-sm-12 pt-5 pl-5 pr-5" style="text-align:center;">
                        <h2 style="font-size:26px;">
                            Enter your details below to unlock 50 Loyalty points!!
                        </h2>
                    </div>                   
                    <div class="row col-md-12 col-xl-12 mt-5" style="text-align:center;">
                        <div class=" col-md-12 col-xl-12 pt-5 pl-5">
                            <span style="font-size:18px; padding-right:10px;">Your Birth Date*</span><input type="date" class="input50" id="txtbirthdt" />
                        </div>
                    </div>
                    <div class="row col-md-12 col-xl-12 " style="text-align:center;">
                        <div class=" col-md-12 col-xl-12 pt-5 pl-5">
                            <span style="font-size:18px; padding-right:10px;">Your Anniversary</span><input type="date" class="input50" id="txtanniversary" />
                        </div>
                    </div>
                    <div class="row col-md-12 col-xl-12" style="text-align:center;">
                        <div class=" col-md-12 col-xl-12 pt-5 pl-5">
                            <span style="font-size:18px; padding-right:10px;">You live in*</span>@Html.DropDownList("location", new SelectList(ViewBag.lstlocation, "Value", "Text"), "Please Select", htmlAttributes: new { @class = "input50", @id = "ddllivein" })
                        </div>
                    </div>                    
                    <div class="row col-md-12 col-sm-12 pl-5" id="divknowabt" style="float:left;display:none;">
                        <div class="col-md-6 col-sm-6 pt-5" style="text-align:right;">
                            <h4 style="font-size:18px;">
                                <b>
                                    How do you know about<br />
                                    Goldmart Jeweller?*
                                </b>
                            </h4>
                        </div>
                        <div class="col-md-6 col-sm-6 pt-5 pl-5 pr-5 ">
                            <input type="radio" name="knowabout" id="rbtknowabt1" />Facebook <br />
                            <input type="radio" name="knowabout" id="rbtknowabt2" />Instagram <br />
                            <input type="radio" name="knowabout" id="rbtknowabt3" />Hoardings <br />
                            <input type="radio" name="knowabout" id="rbtknowabt4" />Newspaper Ads <br />
                            <input type="radio" name="knowabout" id="rbtknowabt5" />Friends / Family <br />
                            <input type="radio" name="knowabout" id="rbtknowabt6" />Store walk-in
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 col-sm-12 pb-5 pt-5" style="text-align:center;">
                        <button type="button" class="btn btn-primary" style="width: 280px; background-color: #1C699F; color:white; font-weight:bold; font-size:18px; border-radius:5px;" id="btnsubmit" onclick="SubmitPoints();">SUBMIT</button>
                    </div>
                </div>
            </div>
        @*</div>*@
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>
<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="Stylesheet" type="text/css" />
<script>
    $(document).ready(function () {
        var today = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate());
        //$("#txtbirthdt").datepicker({
        //    dateFormat: "dd-mm-yy",
        //});
        //$("#txtanniversary").datepicker({
        //    dateFormat: "dd-mm-yy",
        //});
        var dtToday = new Date();       
       
        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();

        if (month < 10)
            month = '0' + month.toString();
        if (day < 10)
            day = '0' + day.toString();

        var maxDate = year + '-' + month + '-' + day;
        $('#txtbirthdt').attr('max', maxDate);
        $('#txtanniversary').attr('max', maxDate);

        $("#txtMobileNo").focusout(function () {
            if ($("#txtMobileNo").val() != "") {
                $('#txtMobileNo').css('border-color', '');
            }
            else {
                $('#txtMobileNo').css('border-color', 'red');
            }
        });
        $("#txtbirthdt").focusout(function () {
            if ($("#txtbirthdt").val() != "") {
                $('#txtbirthdt').css('border-color', '');
            }
            else {
                $('#txtbirthdt').css('border-color', 'red');
            }
        });
        $('#ddllivein').change(function () {
            if ($("#ddllivein option:selected").text() == "Please Select") {
                $('#ddllivein').css('border-color', 'red');
            }
            else {
                $('#ddllivein').css('border-color', '');
            }
        });

    });
    
    function CheckCustomer() {
         
        var returnStatus = true;
        var MobileNo = $('#txtMobileNo').val();
        if ($("#txtMobileNo").val() == "") {
            alert("Please enter Required fields");
            $('#txtMobileNo').css('border-color', 'red');
            returnStatus = false;
        }
        else {
            if (/^[6789]\d{9,9}$/.test(MobileNo)) {

            }
            else {
                alert("Mobile Number entered seems incorrect. Please try again");
                $('#txtMobileNo').css('border-color', 'red');
                returnStatus = false;
            }
        }
        if (returnStatus == true) {
            
            $("#divLoader").show();
             $.ajax({
            type: "POST",
            url: '@Url.Action("GetCustomerStatus", "Feedback")',
            data: '{mobileNo: ' + JSON.stringify($("#txtMobileNo").val()) + ', GroupId: ' + JSON.stringify($("#hdngroupid").val())+'}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
                 success: function (response) {
                     
                     if (response.IsFeedBackGiven) {
                         cuteAlert({
                             type: "error",
                             title: "Oops..",
                             message: "Feedback for this mobile number is already captured today. Thanks!",
                             buttonText: "Okay"
                         })
                         $('#txtMobileNo').val("");
                     }
                     else {
                          
                         
                             if (response.CustomerName != null) {
                                 $('#spnCustName').text(response.CustomerName);
                                 $("#divLoader").hide();
                                 $("#divmember").show();
                                 $("#divwelcome").hide();
                             }
                             else {

                                 $('#spnCustName').text("Esteemed Patron");
                                 $("#divLoader").hide();
                                 $("#divmember").show();
                                 $("#divwelcome").hide();
                             }

                         
                         

                     }
                     

                $("#divLoader").hide();
            },
            failure: function (response) {
                $("#divLoader").hide();
            },
            error: function (response) {

                $("#divLoader").hide();
            }
        });
        }
        else {
            cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Please enter Required fields",
                buttonText: "Okay"
            })
            return false;
        }
    }

    function SubmitRating() {
        var returnStatus = true;
        if ($("#txtMobileNo").val() == "") {
            $('#txtMobileNo').css('border-color', 'red');
            returnStatus = false;
        }
        if ($("#rbtvariety1").is(":checked") || $("#rbtvariety2").is(":checked") || $("#rbtvariety3").is(":checked") || $("#rbtvariety4").is(":checked")) {

        }
        else {
            
            returnStatus = false;
        }
        if ($("#rbtservice1").is(":checked") || $("#rbtservice2").is(":checked") || $("#rbtservice3").is(":checked") || $("#rbtservice4").is(":checked")) {

        }
        else {
            
            returnStatus = false;
        }
        if (returnStatus == true) {

            var ratevariety;
            var rateservice;
            if ($("#rbtvariety1").is(":checked")) {
                ratevariety = 4;
            }
            if ($("#rbtvariety2").is(":checked")) {
                ratevariety = 3;
            }
            if ($("#rbtvariety3").is(":checked")) {
                ratevariety = 2;
            }
            if ($("#rbtvariety4").is(":checked")) {
                ratevariety = 1;
            }
            if ($("#rbtservice1").is(":checked")) {
                rateservice = 4;
            }
            if ($("#rbtservice2").is(":checked")) {
                rateservice = 3;
            }
            if ($("#rbtservice3").is(":checked")) {
                rateservice = 2;
            }
            if ($("#rbtservice4").is(":checked")) {
                rateservice = 1;
            }
            var SeardhData = [];
            item = {}
                      

            SeardhData.push(ratevariety);
            SeardhData.push(rateservice);


            $("#divLoader").show();
            $.ajax({
            type: "POST",
            url: '@Url.Action("SubmitRating", "Feedback")',
            data: '{mobileNo: ' + JSON.stringify($("#txtMobileNo").val()) + ', ranking: ' + JSON.stringify(SeardhData) + ', GroupId: ' + JSON.stringify($("#hdngroupid").val()) + ', outletId: ' + JSON.stringify($("#hdnoutletid").val()) +'}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
                 success: function (response) {
                      
                    // console.log(response.CustomerName);
                     if (response =="true") {
                         var nm = $('#spnCustName').text();
                         $('#spnCustName1').text(nm);
                         if (nm == "Esteemed Patron") {
                             $("#divknowabt").show();
                         }
                         
                             $("#divLoader").hide();
                             $("#divthankyou").show();
                             $("#divmember").hide();
                             $("#divwelcome").hide();

                     }
                     if (response == "false") {
                         // $('#spnCustName').text("Esteemed Patron,");
                         $("#divLoader").hide();
                         $("#divmember").hide();
                         $("#divwelcome").hide();
                     }
                     if (response == "pointsGiven") {
                         $("#divLoader").hide();
                         setTimeout(cuteAlert({
                             type: "success",
                             title: "Save",
                             message: "FeedBack Save Successfully!",
                             buttonText: "Okay"
                         }), 10000);

                         window.location.replace('https://blueocktopus.in/GM_feedback?outletid=10131001');

                     }


                $("#divLoader").hide();
            },
            failure: function (response) {
                $("#divLoader").hide();
            },
            error: function (response) {

                $("#divLoader").hide();
            }
        });
        }
        else {
            cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Please enter Required fields",
                buttonText: "Okay"
            })
            return false;
        }
    }

    function SubmitPoints()
    {
        var returnStatus = true;
        if ($("#txtbirthdt").val() == "") {
            cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Please enter Date of Birth",
                buttonText: "Okay"
            })
            $('#txtbirthdt').css('border-color', 'red');
            returnStatus = false;
        }
        if ($("#ddllivein option:selected").text() == "Please Select") {
            cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Please select you live in",
                buttonText: "Okay"
            })
            $("#ddllivein").css('border-color', 'red');
            returnStatus = false;
        }
        var dtToday = new Date();
        var selecteddate = new Date($('#txtbirthdt').val())        
        dtToday.setFullYear(dtToday.getFullYear() - 18);
      
        if (selecteddate > dtToday) {
            cuteAlert({
                type: "error",
                title: "Oops..",
                message: "Date of Birth must be older than 18 years",
                buttonText: "Okay"
            })
            returnStatus = false;
        }

        if ($("#rbtknowabt1").is(":checked") || $("#rbtknowabt2").is(":checked") || $("#rbtknowabt3").is(":checked") || $("#rbtknowabt4").is(":checked") || $("#rbtknowabt5").is(":checked") || $("#rbtknowabt6").is(":checked")) {
            
        }
        else {
            if ($('#spnCustName1').text() != "Esteemed Patron") {


            }
            else {
                
                returnStatus = false;
            }
        }
        if (returnStatus == true) {
            var knowabout ="";
            if ($("#rbtknowabt1").is(":checked")) {
                 
                knowabout = 1;
                
            }
            if ($("#rbtknowabt2").is(":checked")) {
                knowabout = 2;
                
            }
            if ($("#rbtknowabt3").is(":checked")) {
                knowabout = 3;
            }
            if ($("#rbtknowabt4").is(":checked")) {
                knowabout = 4;
            }
            if ($("#rbtknowabt5").is(":checked")) {
                knowabout = 5;
            }
            if ($("#rbtknowabt6").is(":checked")) {
                knowabout = 6;
            }
            
            
            var annidt;
            if ($("#txtanniversary").val() == null || $("#txtanniversary").val() == "") {
                annidt = null;
            }
            else {
                annidt = $("#txtanniversary").val();
            }
            $("#divLoader").show();
             $.ajax({
            type: "POST",
                 url: '@Url.Action("SubmitPoints", "Feedback")',                
                 data: '{MemberName: ' + JSON.stringify("") + ', Gender: ' + JSON.stringify("") + ',BirthDt: ' + JSON.stringify($("#txtbirthdt").val()) + ', mobileNo: ' + JSON.stringify($("#txtMobileNo").val()) + ', AnniversaryDt: ' + JSON.stringify(annidt) + ', LiveIn: ' + JSON.stringify($("#ddllivein").val()) + ', Knowabt: ' + JSON.stringify(knowabout) + ', GroupId: ' + JSON.stringify($("#hdngroupid").val()) + ', OutletId: ' + JSON.stringify($("#hdnoutletid").val()) +'}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
                 success: function (response) {                     
                     if (response) {
                         $("#divLoader").hide();
                         $("#txtbirthdt").val("");
                         $("#txtanniversary").val("");
                         $('#ddllivein').prop('selectedIndex', 0);

                         setTimeout(cuteAlert({
                             type: "success",
                             title: "Save",
                             message: "FeedBack Save Successfully!",
                             buttonText: "Okay"
                         }), 10000);

                         window.location.replace('https://blueocktopus.in/GM_feedback?outletid=10131001');
                     }
                     else {
                         setTimeout(cuteAlert({
                             type: "success",
                             title: "Save",
                             message: "FeedBack Save Successfully!",
                             buttonText: "Okay"
                         }), 10000);

                         window.location.replace('https://blueocktopus.in/GM_feedback?outletid=10131001');
                     }
                 },
                 failure: function (response) {
                    
                     $("#divLoader").hide();
                 },
                 error: function (response) {
                    
                     $("#divLoader").hide();
                     setTimeout(cuteAlert({
                         type: "success",
                         title: "Save",
                         message: "FeedBack Save Successfully!",
                         buttonText: "Okay"
                     }), 10000);
                     
                     window.location.replace('https://blueocktopus.in/GM_feedback?outletid=10131001');
                 }
             });
        }
        else
        {            
            return false;
        }
    }
</script>

<style>

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>